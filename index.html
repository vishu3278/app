<!doctype html>
<html>

<head>
    <title>DR Solution</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">
    <!-- <link href="https://fonts.googleapis.com/css?family=Nunito:300,400,700&display=swap" rel="stylesheet"> -->
    <link href="https://fonts.googleapis.com/css?family=Oxanium:400,700|Spartan:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/bulma.min.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
    <!-- <script type="text/javascript" src="js/app.js"></script> -->
    <script type="text/javascript">
    function initdevice() {
        document.addEventListener("deviceready", onDeviceReady, false);
    }

    function onDeviceReady() {
        navigator.notification.alert("device ready");
        checkConnection();
        document.addEventListener("offline", onOffline, false);
        document.addEventListener("online", onOnline, false);
        app.permissions = cordova.plugins.permissions;
        alert(app.permissions);
    }

    function onOffline() {
        navigator.notification.alert("You lost connection!");
    }

    function onOnline() {
        navigator.vibrate([200, 400, 200]);
        navigator.notification.alert("You're connected");
    }

    function camPerm() {
        app.permissions.checkPermission("android.permission.CAMERA", function(status) {
            alert('success checking permission');
            alert('Has CAMERA:', status.hasPermission);
            if (!status.hasPermission) {
                app.permissions.requestPermission("android.permission.CAMERA", function(status) {
                    alert('success requesting CAMERA permission');
                    cameraGo();
                }, function(err) {
                    alert('failed to set permission');
                });
            }
        }, function(err) {
            alert(err);
        });
    }

    function checkConnection() {
        var networkState = navigator.connection.type;

        var states = {};
        states[Connection.UNKNOWN] = 'Unknown connection';
        states[Connection.ETHERNET] = 'Ethernet connection';
        states[Connection.WIFI] = 'WiFi connection';
        states[Connection.CELL_2G] = 'Cell 2G connection';
        states[Connection.CELL_3G] = 'Cell 3G connection';
        states[Connection.CELL_4G] = 'Cell 4G connection';
        states[Connection.CELL] = 'Cell generic connection';
        states[Connection.NONE] = 'No network connection';

        $("#networkError").html(states[networkState]);
        // alert('Connection type: ' + states[networkState]);
        if (states[networkState] !== Connection.NONE) {
            navigator.vibrate([200, 400, 200]);
        } else {
            navigator.notification.alert("Connect to internet to proceed!");
        }
        return (states[networkState]);
    }

    var scanOptions = {
        'prompt_message': 'Scan a Code', // Change the info message. A blank message ('') will show a default message
        'orientation_locked': true, // Lock the orientation screen
        'camera_id': 0, // Choose the camera source
        'beep_enabled': true, // Enables a beep after the scan
        'scan_type': 'normal', // Types of scan mode: normal = default black with white background / inverted = white bars on dark background / mixed = normal and inverted modes
        'barcode_formats': [
            'QR_CODE',
            'CODE_39',
            'CODE_128'
        ], // Put a list of formats that the scanner will find. A blank list ([]) will enable scan of all barcode types
        'extras': {} // Additional extra parameters. See [ZXing Journey Apps][1] IntentIntegrator and Intents for more details
    }

    function scanQR(arguments) {
        alert("initiate");
        window.plugins.zxingPlugin.scan(scanOptions, onSuccess, onFailure);
        function onSuccess (result) {
        	navigator.notification.alert(result);
        }
        function onFailure (err) {
        	navigator.notification.alert(err);
        }
    }

    function cameraGo() {
        var options = {
            sourceType: Camera.PictureSourceType.CAMERA,
            //        sourceType:Camera.PictureSourceType.PHOTOLIBRARY,
            //        quality:50,
            destinationType: Camera.DestinationType.FILE_URI
        };

        navigator.camera.getPicture(successCallback, errorCallback, options);

        function successCallback(imageURI) {
            $("#capturi").html(imageURI);
            $("#capture").attr('src', imageURI);
        };

        function errorCallback(message) {
            alert(message);
        }
    }

    function cameraClean() {
        navigator.camera.cleanup(onSuccess, onFail);

        function onSuccess() {
            console.log("Camera cleanup success.")
        }

        function onFail(message) {
            alert('Failed because: ' + message);
        }
    }
    </script>
</head>

<body onload="initdevice()">
    <section class="hero is-bold is-danger">
        <div class="hero-body">
            <div class="container">
                <h1 class="title">
                    Dr Solution
                </h1>
                <h2 class="subtitle">
                    Scan card
                </h2>
            </div>
        </div>
    </section>
    <div class="container is-fluid">
        <div id="networkError" class="notification is-warning">
        </div>
        <div class="card">
            <div class="card-content">
                <p>Scan QR code using this app.</p>
                <!-- <button class="button is-primary">Scan</button> -->
            </div>
            <div>
                <button type="button" onclick="scanQR()" class="button">Scan</button>
                <button type="button" onclick="alert('Compass')" class="button">Compass</button>
                <button type="button" onclick="cameraGo()" class="button">Camera</button>
            </div>
        </div>
    </div>
    <div id="page"></div>
    <script type="text/javascript" src="cordova.js"></script>
</body>

</html>